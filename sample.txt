using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Zyanken_Game
{
    class Program
    {
        //手の参照用にフィールドを用意
        static string[] Otete = { "グー", "チョキ", "パー" };

        static void Main(string[] Args)
        {
            Console.WriteLine("おい、ジャンケンしろよ。\n");
            Console.WriteLine("ジャンケンしてあげますか？");

            while (true)
            /*()内の条件式が真になる限り繰り返す
             continue文が実行されるとループの先頭に戻り、break文が実行されるとループを抜け出す
             →(true)にすることでそれらが無ければ無限ループが発生
            */
            {
                Console.WriteLine("ジャンケンする：Yを入力");
                Console.WriteLine("もう帰る：Nを入力");

                string y_n = Console.ReadLine();

                //入力が適正であるかのチェックを行う
                if (y_n == "y" || y_n == "Y")
                {
                    Console.WriteLine("\n闇のゲームの始まりだ\n");
                    GameStart();
                }
                else if (y_n == "n" || y_n == "N")
                {
                    Console.WriteLine("\n帰りたいのを無理に引き留めるのは気が引けるから帰っていいよ\n");
                    Environment.Exit(0);    //無限ループから抜け出す
                }
                else
                {
                    Console.WriteLine("\nYESかNOか聞かれたならYESかNOで答えろよ\n");　//入力が適正でない場合入力に戻る
                }
            }
        }

        static void GameStart()
        {
            //ジャンケンで出す手の選択
            Console.WriteLine("運命の選択");
            Console.WriteLine("0:グー");
            Console.WriteLine("1:チョキ");
            Console.WriteLine("2:パー");

            try//try-catchで文字列や膨大な桁数の入力に対応
            {
                int hand = int.Parse(Console.ReadLine());
                CheckHand(ref hand); //CheckHandメソッドへ行き、必要ならhandの値を置き換える
                Battle(ref hand);　//Battleメソッドへ行き運命の戦いを行う
            }
           　catch (FormatException)
            {
                Console.Write("\n選べる運命はこの三択だぜ\n");
                GameStart();
            }
            catch (OverflowException)
            {
                Console.Write("\n選べる運命はこの三択だぜ\n");
                GameStart();
            }
        }

        static void CheckHand(ref int hand)
        {
            while (true)
            {
                //選択した手が適正かどうかのチェックを行う
                if (hand == (0) || hand == (1) || hand == (2))
                {
                    break;  //値が適正なのでループを抜ける
                }
                else
                {
                    Console.WriteLine("\n選べる運命はこの三択だぜ");
                    Console.WriteLine("0:グー");
                    Console.WriteLine("1:チョキ");
                    Console.WriteLine("2:パー");

                    hand = int.Parse(Console.ReadLine());
                }
            }
        }

        static void Battle(ref int hand)
        {
            Random rnd = new System.Random();    // インスタンスを生成
            int intResult = rnd.Next(3);         // 0～2の乱数を取得
            int cpu = intResult;                 // 取得した乱数をcpuの手に反映

            //出した手を表示させるために文字列へ変換
            string strHand = hand.ToString();
            string strCpu = cpu.ToString();

            //互いの選んだ手を開示
            Console.WriteLine("\n自分の出した手：" + Otete.GetValue(int.Parse(strHand)));
            Console.WriteLine("相手の出した手：" + Otete.GetValue(int.Parse(strCpu)));

            //自分の手と相手の手の差の値からジャンケンの勝敗を出力
            int battleJudge = (hand - cpu + 3) % 3;

            if (battleJudge == 2)
            {
                Console.WriteLine("\n>>>お前の勝ちだぜ!!<<<\n");
                Console.WriteLine("\n続けてジャンケンする？");
            }
            else if (battleJudge == 1)
            {
                //負けると異常な勢いで煽ってくる
                Console.WriteLine("\n>>>お前の負け!!敗北!!人生の敗北者!!生きてて何もいいことがなかった!!死!!!<<<\n");
                Console.WriteLine("\n続けてジャンケンする？\n");
            }
            else
            {
                Console.WriteLine("\n>>>あいこだぜ!!<<<");
                Console.WriteLine("あいこが出たのでもう一度↓\n");
                //あいこなので手の選択へ戻る
                GameStart();
            }
        }
    }
}
